%{!?__python2: %global __python2 /usr/bin/python2}
%{!?python2_sitelib: %global python2_sitelib %(%{__python2} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")}
%{!?python2_sitearch: %global python2_sitearch %(%{__python2} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib(1))")}

Name: storm-info-provider
Version: 1.7.7
Release: 0%{?dist}
Summary: The StoRM dynamic info provider component

Group: Applications/Text
License: Apache License 2.0
URL: https://github.com/italiangrid/storm-info-provider

Source:    %{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

BuildArch: noarch

BuildRequires: python2-devel

Requires: python
Requires: python-ldap

%description
This is the installation bundle for the StoRM info provider component.

%define info_provider_pymodule_name storminfoprovider

%prep
%setup -q -n %{name}

%install
rm -rf $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT

install -d $RPM_BUILD_ROOT%{_libexecdir}/storm-info-provider
install -pm 0755 src/storm-info-provider $RPM_BUILD_ROOT%{_libexecdir}/storm-info-provider/

install -d $RPM_BUILD_ROOT%{python2_sitelib}/%{info_provider_pymodule_name}
install -pm 0644 src/%{info_provider_pymodule_name}/* $RPM_BUILD_ROOT%{python2_sitelib}/%{info_provider_pymodule_name}/

%files
%defattr(-,root,root,-)

%dir %{_libexecdir}/%{name}
%{_libexecdir}/%{name}/storm-info-provider

%{python2_sitelib}/%{info_provider_pymodule_name}/

%clean
rm -rf $RPM_BUILD_ROOT