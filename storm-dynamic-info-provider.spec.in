%{!?__python2: %global __python2 /usr/bin/python2}
%{!?python2_sitelib: %global python2_sitelib %(%{__python2} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")}
%{!?python2_sitearch: %global python2_sitearch %(%{__python2} -c "from distutils.sysconfig import get_python_lib; print(get_python_lib(1))")}

Name: storm-dynamic-info-provider
Version: 1.7.7
Release: 0%{?dist}
Summary: The StoRM dynamic info provider component

Group: Applications/Text
License: Apache License 2.0
URL: https://github.com/italiangrid/storm-info-provider

Source:    %{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

BuildArch: noarch

BuildRequires: python2-devel

Requires: python
Requires: python-ldap
Requires: python-argparse

%description
This is the installation bundle for the StoRM info provider component.

%prep
%setup -q -n %{name}

%install
rm -rf $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT

install -d $RPM_BUILD_ROOT%{_libexecdir}
install -pm 0755 src/storm-info-provider $RPM_BUILD_ROOT%{_libexecdir}/

install -d $RPM_BUILD_ROOT%{python2_sitelib}/info_provider
install -d $RPM_BUILD_ROOT%{python2_sitelib}/info_provider/glue
install -pm 0644 src/info_provider/glue/* $RPM_BUILD_ROOT%{python2_sitelib}/info_provider/glue/
install -pm 0644 src/info_provider/__init__.py $RPM_BUILD_ROOT%{python2_sitelib}/info_provider/
install -pm 0644 src/info_provider/configuration.py $RPM_BUILD_ROOT%{python2_sitelib}/info_provider/
install -pm 0644 src/info_provider/http_utils.py $RPM_BUILD_ROOT%{python2_sitelib}/info_provider/
install -pm 0644 src/info_provider/space_info.py $RPM_BUILD_ROOT%{python2_sitelib}/info_provider/

%files
%defattr(-,root,root,-)

%{_libexecdir}/storm-info-provider

%{python2_sitelib}/info_provider/

%clean
rm -rf $RPM_BUILD_ROOT